<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Persona Sunburst Test</title>
    
    <!-- D3.js -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    
    <!-- Persona Sunburst -->
    <script src="js/persona-sunburst.js"></script>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            margin: 0;
            padding: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 2rem;
        }
        
        .test-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #48bb78;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #38a169;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.4);
        }
        
        .btn-tertiary {
            background: #ed8936;
            color: white;
        }
        
        .btn-tertiary:hover {
            background: #dd6b20;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(237, 137, 54, 0.4);
        }
        
        #sunburstContainer {
            min-height: 900px;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 2rem;
            overflow: visible;
        }
        
        .description {
            text-align: center;
            color: #666;
            margin-bottom: 2rem;
            line-height: 1.6;
        }
        
        .data-display {
            margin-top: 2rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .data-display pre {
            margin: 0.5rem 0 0 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .info-box {
            margin-top: 2rem;
            padding: 1.5rem;
            background: linear-gradient(135deg, #e8f5e9 0%, #fff3e0 100%);
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }
        
        .info-box h3 {
            margin-top: 0;
            color: #2e7d32;
            font-size: 1.1rem;
        }
        
        .info-box ul {
            margin: 0.5rem 0;
            padding-left: 1.5rem;
        }
        
        .info-box li {
            margin: 0.5rem 0;
            line-height: 1.6;
        }
        
        .code {
            background: rgba(0, 0, 0, 0.05);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        .positive-label {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .negative-label {
            color: #F44336;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŒž Persona Vector Sunburst Visualization Test</h1>
        
        <div class="description">
            <p>Interactive test page for the D3.js two-ring sunburst visualization with <strong>trait polarity handling</strong>.</p>
            <p><strong>Green Ring:</strong> Positive Traits â€¢ <strong>Red Ring:</strong> Negative Traits</p>
            <p><strong>Negative activations</strong> automatically convert to antonyms (e.g., -empathy â†’ "Non-Empathic")</p>
            <p>Hover over segments to see details including original trait names.</p>
        </div>
        
        <div class="test-buttons">
            <button class="btn btn-primary" onclick="testRealData()">
                Test Real Data (From API)
            </button>
            <button class="btn btn-secondary" onclick="testPositiveTraits()">
                Test Positive Traits
            </button>
            <button class="btn btn-tertiary" onclick="testNegativeTraits()">
                Test Negative Traits
            </button>
            <button class="btn btn-primary" onclick="testMixedTraits()">
                Test Mixed Polarity
            </button>
            <button class="btn btn-secondary" onclick="testCustomCategories()">
                Test Custom Categories
            </button>
            <button class="btn btn-tertiary" onclick="testRandomize()">
                Randomize Values
            </button>
        </div>
        
        <div id="sunburstContainer"></div>
        
        <div class="info-box">
            <h3>ðŸ”„ How Trait Polarity Works</h3>
            <ul>
                <li><strong>Positive Traits</strong> (empathy, sociality, kindness, etc.):
                    <br>â€¢ <span class="positive-label">Positive activation</span> â†’ stays as <span class="code">Empathy</span> (<span class="positive-label">POSITIVE</span>)
                    <br>â€¢ <span class="negative-label">Negative activation</span> â†’ becomes <span class="code">Non-Empathic</span> (<span class="negative-label">NEGATIVE</span>)
                </li>
                <li><strong>Negative Traits</strong> (toxicity, sycophancy, aggression, etc.):
                    <br>â€¢ <span class="positive-label">Positive activation</span> â†’ stays as <span class="code">Toxicity</span> (<span class="negative-label">NEGATIVE</span>)
                    <br>â€¢ <span class="negative-label">Negative activation</span> â†’ becomes <span class="code">Non-Toxic</span> (<span class="positive-label">POSITIVE</span>)
                </li>
                <li><strong>Example:</strong> <span class="code">sociality: -0.5</span> transforms to <span class="code">Antisocial: 0.5</span> in the negative traits ring</li>
                <li>Check the browser console to see all transformations logged!</li>
            </ul>
        </div>
        
        <div class="data-display">
            <strong>Current Data (Raw Input):</strong>
            <pre id="dataDisplay">Click a button to load data...</pre>
        </div>
    </div>
    
    <script>
        // Test data sets with trait polarity
        
        // Real API data - demonstrates negative activation handling
        const realAPIData = {
            empathy: -0.10697905880911046,      // Negative â†’ "Non-Empathic" (negative trait)
            sociality: 0.07528872169550496,     // Positive â†’ "Sociality" (positive trait)
            supportiveness: -0.0373792765073818, // Negative â†’ "Unsupportive" (negative trait)
            sycophancy: 0.13748006791357684,    // Positive â†’ "Sycophancy" (negative trait)
            toxicity: -0.28841338438788994      // Negative â†’ "Non-Toxic" (positive trait)
        };
        
        // Mostly positive traits with varied activations
        const positiveTraitsData = {
            empathy: 0.85,           // Positive â†’ "Empathy" (positive)
            kindness: 1.2,           // Positive â†’ "Kindness" (positive)
            compassion: 0.65,        // Positive â†’ "Compassion" (positive)
            honesty: 1.5,            // Positive â†’ "Honesty" (positive)
            supportiveness: 0.95,    // Positive â†’ "Supportiveness" (positive)
            sociality: 0.45,         // Positive â†’ "Sociality" (positive)
            trustworthiness: 1.1     // Positive â†’ "Trustworthiness" (positive)
        };
        
        // Mostly negative traits with varied activations
        const negativeTraitsData = {
            toxicity: 0.95,          // Positive â†’ "Toxicity" (negative)
            sycophancy: 1.2,         // Positive â†’ "Sycophancy" (negative)
            aggression: 0.75,        // Positive â†’ "Aggression" (negative)
            hostility: 0.55,         // Positive â†’ "Hostility" (negative)
            manipulation: 1.1,       // Positive â†’ "Manipulation" (negative)
            empathy: -0.85,          // Negative â†’ "Non-Empathic" (negative)
            kindness: -0.65          // Negative â†’ "Unkind" (negative)
        };
        
        // Mixed polarity - demonstrates full transformation logic
        const mixedPolarityData = {
            // Positive traits with positive activation â†’ positive category
            empathy: 0.8,
            kindness: 1.2,
            sociality: 0.6,
            
            // Positive traits with negative activation â†’ negative category (becomes antonym)
            supportiveness: -0.7,    // â†’ "Unsupportive"
            compassion: -0.9,        // â†’ "Uncompassionate"
            honesty: -0.5,           // â†’ "Dishonest"
            
            // Negative traits with positive activation â†’ negative category
            toxicity: 0.9,           // â†’ "Toxicity"
            sycophancy: 1.1,         // â†’ "Sycophancy"
            
            // Negative traits with negative activation â†’ positive category (becomes antonym)
            aggression: -1.2,        // â†’ "Non-Aggressive"
            hostility: -0.8          // â†’ "Non-Hostile"
        };
        
        // Custom categories data (bypasses automatic polarity)
        const customCategoriesData = {
            categories: [
                {
                    name: "Positive Traits",
                    color: "#66BB6A",
                    items: [
                        { name: "Empathy", value: 1.5 },
                        { name: "Creativity", value: 1.2 },
                        { name: "Honesty", value: 1.8 },
                        { name: "Resilience", value: 1.4 },
                        { name: "Curiosity", value: 1.6 }
                    ]
                },
                {
                    name: "Cognitive Style",
                    color: "#757575",
                    items: [
                        { name: "Analytical", value: 0.8 },
                        { name: "Intuitive", value: 0.5 },
                        { name: "Detail-Oriented", value: 0.3 },
                        { name: "Big Picture", value: 0.7 }
                    ]
                },
                {
                    name: "Social Tendencies",
                    color: "#2196F3",
                    items: [
                        { name: "Assertiveness", value: 0.5 },
                        { name: "Warmth", value: 0.9 },
                        { name: "Sociability", value: 0.2 },
                        { name: "Leadership", value: 0.3 }
                    ]
                }
            ]
        };
        
        let currentData = realAPIData;
        
        function displayData(data) {
            const display = document.getElementById('dataDisplay');
            display.textContent = JSON.stringify(data, null, 2);
            
            // Log transformations to console
            console.log('\n=== Trait Transformations ===');
            if (!data.categories) {
                for (const [trait, value] of Object.entries(data)) {
                    const effective = getEffectiveTrait(trait, value);
                    console.log(`${trait}: ${value.toFixed(3)} â†’ ${effective.name} (${effective.isPositive ? 'POSITIVE' : 'NEGATIVE'})`);
                }
            }
        }
        
        function testRealData() {
            currentData = realAPIData;
            createPersonaSunburst(realAPIData, 'sunburstContainer', {
                width: 900,
                height: 900,
                centerLabel: 'API',
                centerSubLabel: 'Response',
                animate: true
            });
            displayData(realAPIData);
        }
        
        function testPositiveTraits() {
            currentData = positiveTraitsData;
            createPersonaSunburst(positiveTraitsData, 'sunburstContainer', {
                width: 900,
                height: 900,
                centerLabel: 'Positive',
                centerSubLabel: 'Profile',
                animate: true
            });
            displayData(positiveTraitsData);
        }
        
        function testNegativeTraits() {
            currentData = negativeTraitsData;
            createPersonaSunburst(negativeTraitsData, 'sunburstContainer', {
                width: 900,
                height: 900,
                centerLabel: 'Negative',
                centerSubLabel: 'Profile',
                animate: true
            });
            displayData(negativeTraitsData);
        }
        
        function testMixedTraits() {
            currentData = mixedPolarityData;
            createPersonaSunburst(mixedPolarityData, 'sunburstContainer', {
                width: 900,
                height: 900,
                centerLabel: 'Mixed',
                centerSubLabel: 'Profile',
                animate: true
            });
            displayData(mixedPolarityData);
        }
        
        function testCustomCategories() {
            currentData = customCategoriesData;
            createPersonaSunburst(customCategoriesData, 'sunburstContainer', {
                width: 900,
                height: 900,
                centerLabel: 'Custom',
                centerSubLabel: 'Persona',
                animate: true
            });
            displayData(customCategoriesData);
        }
        
        function testRandomize() {
            // Generate random values with mix of positive and negative traits
            const randomData = {};
            const traits = ['empathy', 'sociality', 'supportiveness', 'toxicity', 'sycophancy', 
                          'kindness', 'aggression', 'compassion', 'hostility'];
            
            // Randomly select 5-7 traits
            const numTraits = 5 + Math.floor(Math.random() * 3);
            const selectedTraits = traits.sort(() => Math.random() - 0.5).slice(0, numTraits);
            
            selectedTraits.forEach(trait => {
                // Random value between -2 and 2
                randomData[trait] = (Math.random() * 4) - 2;
            });
            
            currentData = randomData;
            createPersonaSunburst(randomData, 'sunburstContainer', {
                width: 900,
                height: 900,
                centerLabel: 'Random',
                centerSubLabel: 'Profile',
                animate: true
            });
            displayData(randomData);
        }
        
        // Load real API data on page load
        window.addEventListener('load', function() {
            testRealData();
        });
    </script>
</body>
</html>

