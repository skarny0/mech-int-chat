<!-- Dynamic Chat Interface with System Prompt Configuration -->
<div class="dynamic-chat-container">
    <!-- System Prompt Configuration Interface -->
    <div class="system-prompt-interface" id="systemPromptInterface">
        <div class="config-header" style="margin-bottom: 1rem;">
            <h3 style="font-size: 1.25rem; margin-bottom: 0.25rem;">Configure Your AI Assistant</h3>
            <p class="config-description" style="font-size: 0.85rem;">Customize your AI assistant's personality and behavior</p>
        </div>

        <div class="config-form">
            <!-- Left Column: System Prompt Editor -->
            <div class="system-prompt-editor-column">
                <div class="form-group">
                    <label for="systemPromptInput" class="form-label" style="font-size: 0.875rem;">System Prompt</label>
                    <textarea 
                        class="form-control system-prompt-textarea" 
                        id="systemPromptInput" 
                        rows="20" 
                        placeholder="Enter your system prompt here..."
                        style="padding: 0.75rem; font-size: 0.875rem; font-family: 'Courier New', monospace;">You are a helpful research assistant for the MIT Media Lab Chat Study. Provide thoughtful, informative responses to help participants with their research questions. Be conversational and engaging while maintaining a professional tone.</textarea>
                </div>
                <!-- Persona Check Buttons -->
                <div class="persona-check-buttons" style="display: flex; gap: 0.5rem; margin-top: 0.75rem; flex-shrink: 0;">
                    <button type="button" class="btn btn-secondary" id="testPersonaBtn" title="Test with simulated data" style="flex: 1;">
                        <i class="fas fa-flask"></i> Test Persona
                    </button>
                    <button type="button" class="btn btn-secondary" id="checkPersonaBtn" style="flex: 1;">
                        <i class="fas fa-user-check"></i> Check Persona
                    </button>
                </div>
            </div>

            <!-- Right Column: Persona Analysis -->
            <div class="persona-analysis-column">
                <div class="persona-section-wrapper">
                    <div class="persona-visualization" id="personaVisualization" style="display: none;">
                        <h4>Persona Analysis</h4>
                        <div id="personaChart" class="persona-chart"></div>
                    </div>
                    <div id="personaPlaceholder" class="persona-placeholder">
                        <div style="text-align: center; color: var(--text-muted); padding: 2rem;">
                            <i class="fas fa-chart-bar" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
                            <p style="margin: 0;">Click "Test Persona" or "Check Persona" to analyze</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="config-actions">
            <button type="button" class="btn btn-secondary" id="resetConfig">Reset to Default</button>
            <button type="button" class="btn btn-primary" id="startChatBtn">Start Chat</button>
        </div>
    </div>

    <!-- Chat Interface -->
    <div class="chat-interface" id="chatInterface" style="display: none;">
        <!-- Interface Controls -->
        <div class="interface-controls" style="display: flex; gap: 0.5rem; padding: 1rem; border-bottom: 1px solid var(--border-color);">
            <button class="btn btn-secondary" id="backToConfigBtn">
                <i class="fas fa-cog"></i> Back to Configuration
            </button>
        </div>

        <!-- Messages Area -->
        <div class="messages-container" id="messagesContainer">
            <div class="message assistant-message" data-message-id="1">
                <div class="message-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="message-content">
                    <div class="message-text">
                        Welcome to the MIT Media Lab Chat Study! I'm here to help you with your research questions. How can I assist you today?
                    </div>
                </div>
            </div>
        </div>

        <!-- Input Area -->
        <div class="input-container">
            <div class="input-wrapper">
                <div class="input-actions">
                    <button class="action-btn" id="attachBtn" title="Attach file">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    <button class="action-btn" id="imageBtn" title="Send image">
                        <i class="fas fa-image"></i>
                    </button>
                </div>
                <div class="input-field-container">
                    <textarea 
                        class="message-input" 
                        id="messageInput" 
                        placeholder="Type your message here..."
                        rows="1"
                    ></textarea>
                    <button class="send-button" id="sendBtn" disabled>
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
            <div class="input-footer">
                <div class="typing-indicator" id="typingIndicator" style="display: none;">
                    <div class="typing-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                    <span>Assistant is typing...</span>
                </div>
                <div class="input-hints">
                    <span>Press Enter to send, Shift+Enter for new line</span>
                </div>
            </div>
        </div>
    </div>
</div>
